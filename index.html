const area = mat.dataset.area;
          const creditos = parseInt(mat.dataset.creditos) || 0;
          creditosPorArea[area] = (creditosPorArea[area] || 0) + creditos;
        }
      });
      return creditosPorArea;
    }

    // Función para calcular créditos totales aprobados
    function calcularCreditosTotales() {
      let total = 0;
      aprobadas.forEach(id => {
        const mat = subjects.find(s => s.dataset.id === id);
        if (mat) {
          total += parseInt(mat.dataset.creditos) || 0;
        }
      });
      return total;
    }

    // Función que determina si una materia está habilitada para cursar
    function estaHabilitada(mat, creditosPorArea, creditosTotales) {
      // 1) Chequear previas
      const prereqs = parsePrereqs(mat.dataset.prereq);
      for (const pre of prereqs) {
        if (!aprobadas.has(pre)) return false;
      }

      // 2) Chequear créditos mínimos en área si aplica
      const area = mat.dataset.area;
      if (mat.dataset.creditosRequeridosArea) {
        const reqArea = mat.dataset.creditosRequeridosArea;
        const reqAreaCantidad = parseInt(mat.dataset.creditosRequeridosAreaCantidad || '0');
        if (!creditosPorArea[reqArea] || creditosPorArea[reqArea] < reqAreaCantidad) return false;
      }

      // 3) Chequear créditos mínimos totales si aplica
      if (mat.dataset.creditosRequeridosTotal) {
        const reqTotal = parseInt(mat.dataset.creditosRequeridosTotal);
        if (creditosTotales < reqTotal) return false;
      }

      // 4) Chequear créditos mínimos por otras áreas (opcional)
      // Para soportar varios requisitos de áreas distintas (ej. gestión financiera)
      for (const key of Object.keys(mat.dataset)) {
        if (key.startsWith('creditosRequeridosArea')) {
          // Excluimos el genérico creditosRequeridosArea y creditosRequeridosAreaCantidad
          if (key === 'creditosRequeridosArea' || key === 'creditosRequeridosAreaCantidad') continue;
          // Ejemplo: creditosRequeridosAreaAdministracion, creditosRequeridosAreaJuridica
          const areaReq = key.replace('creditosRequeridosArea', '').toLowerCase();
          const reqCant = parseInt(mat.dataset[key] || '0');
          // Normalizamos área a minúsculas y comparamos con creditosPorArea
          const creditosAreaAprob = creditosPorArea[areaReq.charAt(0).toUpperCase() + areaReq.slice(1)] || 0;
          if (creditosAreaAprob < reqCant) return false;
        }
      }

      return true;
    }

    // Función para actualizar visualización y estados
    function actualizarEstado() {
      const creditosPorArea = calcularCreditosPorArea();
      const creditosTotales = calcularCreditosTotales();

      subjects.forEach(mat => {
        const id = mat.dataset.id;

        if (aprobadas.has(id)) {
          mat.classList.add('aprobado');
          mat.classList.remove('no_cursada');
          mat.classList.remove('no_habilitada');
        } else {
          if (estaHabilitada(mat, creditosPorArea, creditosTotales)) {
            mat.classList.add('no_cursada');
            mat.classList.remove('no_habilitada');
            mat.classList.remove('aprobado');
          } else {
            mat.classList.add('no_habilitada');
            mat.classList.remove('no_cursada');
            mat.classList.remove('aprobado');
          }
        }
      });
    }

    // Evento click para marcar/desmarcar como aprobada
    subjects.forEach(mat => {
      mat.addEventListener('click', () => {
        const id = mat.dataset.id;
        if (aprobadas.has(id)) {
          aprobadas.delete(id);
        } else {
          aprobadas.add(id);
        }
        actualizarEstado();
      });
    });

    // Inicializar estado al cargar
    actualizarEstado();
  </script>
</body>
</html>
