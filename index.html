<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Malla Contador Público - Semestres</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <h1>Malla Contador Público (FCEA) - Por Semestres</h1>

  <div class="grid">
    <!-- Semestres y materias aquí, con sus data-* para lógica -->
    <div class="semester">
      <h2>Semestre 1</h2>
      <div class="subject no_cursada" data-id="conceptos-contables" data-area="Contabilidad e Impuestos" data-creditos="10" data-prereq="">Conceptos contables</div>
      <div class="subject no_cursada" data-id="administracion-gestion-organizaciones-1" data-area="Administracion" data-creditos="10" data-prereq="">Administración y Gestión de las Organizaciones 1</div>
      <div class="subject no_cursada" data-id="introduccion-microeconomia" data-area="Economia" data-creditos="10" data-prereq="">Introducción a la Microeconomía</div>
      <div class="subject no_cursada" data-id="calculo-1a" data-area="Metodos Cuantitativos" data-creditos="5" data-prereq="">Cálculo 1A</div>
      <div class="subject no_habilitada" data-id="calculo-1b" data-area="Metodos Cuantitativos" data-creditos="5" data-prereq="calculo-1a">Cálculo 1B</div>
    </div>

    <!-- Sigue igual para los demás semestres -->
    <!-- ... -->
  </div>

  <footer>
    <p>Actualizado por Melina - Julio 2025</p>
  </footer>

  <script>
    // Función para convertir un string de prereqs separados por coma en array
    function parsePrereqs(prereqStr) {
      return prereqStr ? prereqStr.split(',').map(s => s.trim()).filter(s => s.length > 0) : [];
    }

    const subjects = Array.from(document.querySelectorAll('.subject'));
    let aprobadas = new Set();

    function calcularCreditosPorArea() {
      const creditosPorArea = {};
      aprobadas.forEach(id => {
        const mat = subjects.find(s => s.dataset.id === id);
        if (mat) {
          const area = mat.dataset.area;
          const creditos = parseInt(mat.dataset.creditos) || 0;
          creditosPorArea[area] = (creditosPorArea[area] || 0) + creditos;
        }
      });
      return creditosPorArea;
    }

    function calcularCreditosTotales() {
      let total = 0;
      aprobadas.forEach(id => {
        const mat = subjects.find(s => s.dataset.id === id);
        if (mat) {
          total += parseInt(mat.dataset.creditos) || 0;
        }
      });
      return total;
    }

    function estaHabilitada(mat, creditosPorArea, creditosTotales) {
      const prereqs = parsePrereqs(mat.dataset.prereq);
      for (const pre of prereqs) {
        if (!aprobadas.has(pre)) return false;
      }

      // Revisión créditos mínimos en área
      if (mat.dataset.creditosRequeridosArea) {
        const areaReq = mat.dataset.creditosRequeridosArea;
        const cantReq = parseInt(mat.dataset.creditosRequeridosAreaCantidad || '0');
        if (!creditosPorArea[areaReq] || creditosPorArea[areaReq] < cantReq) return false;
      }

      // Créditos totales mínimos
      if (mat.dataset.creditosRequeridosTotal) {
        const minTotal = parseInt(mat.dataset.creditosRequeridosTotal);
        if (creditosTotales < minTotal) return false;
      }

      // Créditos mínimos por otras áreas (ejemplo: distintas áreas en misma materia)
      for (const key of Object.keys(mat.dataset)) {
        if (key.startsWith('creditosRequeridosArea') && key !== 'creditosRequeridosArea' && key !== 'creditosRequeridosAreaCantidad') {
          const areaName = key.replace('creditosRequeridosArea', '');
          const areaNameLower = areaName.charAt(0).toUpperCase() + areaName.slice(1).toLowerCase();
          const cant = parseInt(mat.dataset[key]);
          if ((creditosPorArea[areaNameLower] || 0) < cant) return false;
        }
      }

      return true;
    }

    function actualizarEstado() {
      const creditosPorArea = calcularCreditosPorArea();
      const creditosTotales = calcularCreditosTotales();

      subjects.forEach(mat => {
        const id = mat.dataset.id;
        if (aprobadas.has(id)) {
          mat.classList.add('aprobado');
mat.classList.remove('no_cursada', 'no_habilitada');
        } else {
          if (estaHabilitada(mat, creditosPorArea, creditosTotales)) {
            mat.classList.add('no_cursada');
            mat.classList.remove('no_habilitada', 'aprobado');
          } else {
            mat.classList.add('no_habilitada');
            mat.classList.remove('no_cursada', 'aprobado');
          }
        }
      });
    }

    subjects.forEach(mat => {
      mat.addEventListener('click', () => {
        const id = mat.dataset.id;
        if (aprobadas.has(id)) {
          aprobadas.delete(id);
        } else {
          aprobadas.add(id);
        }
        actualizarEstado();
      });
    });

    actualizarEstado();
  </script>
</body>
</html>
